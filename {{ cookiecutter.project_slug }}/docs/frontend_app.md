# Frontend App

## Overview

The 'Frontend App' uses [Create React App](https://github.com/facebook/create-react-app)
with [TypeScript](https://www.typescriptlang.org) and
[react-router](https://reacttraining.com/react-router/).

You can learn more in the
[Create React App documentation](https://facebook.github.io/create-react-app/docs/getting-started).

To learn React, check out the [React documentation](https://reactjs.org/).


## Running the dev server on your host machine

If you have `yarn` installed on your host machine, you can start the dev server
by running `yarn start`:

```
$ cd frontend_app
$ yarn run start
```

You can then access the dev server at http://localhost:3000

The page will reload if you make edits. You will also see any lint errors in
the console.

Note: the `start` and `test` scripts in `package.json` have been extended
with a bash script to load some dev environment variables. If you want to run
the dev server directly on a Windows host you will need to use an alternative
to the Windows command prompt, such as Cygwin.

## Running the dev server from the controller VM

If you don't have `yarn` installed on your host machine you can start the dev
server on the `controller` VM instead, although you may find this to be slower:

```
$ ./ssh_frontend.sh
[vagrant@controller frontend_app]$ yarn run start
```

You can then access the dev server at http://{{ cookiecutter.controller_hostname }}:3000

## Formatting

To run the [prettier](https://prettier.io) formatter:

```
$ yarn run prettier
```

## Running Tests

You can run tests with:

```
$ yarn run test
```

For more information see the Create React App documentation on
[running tests](https://create-react-app.dev/docs/running-tests).

## Creating a Production-Ready Build

A production-ready build of the frontend app is automatically generated by the
Ansible provisioning. This is an optimised and minified build which is ready to
be deployed.

If you want to see this build in action on the Vagrant dev environment, run:

```
vagrant up --provision
```

and visit https://{{ cookiecutter.frontend_app_dev_hostname }}.

You can also use ansible tags to limit the playbook to just the tasks needed to
update the frontend app:

```
VAGRANT_ANSIBLE_TAGS=update_frontend_app vagrant up --provision
```

## Serving in Production

The production build of the frontend app is served with NGINX. All http
requests are redirected to https. The contents of `build/static/` are served as
regular files, with all other urls served using `index.html` if a file with
a matching name is not found. We rely on `react-router` to handle matching/non
matching routes accordingly.
